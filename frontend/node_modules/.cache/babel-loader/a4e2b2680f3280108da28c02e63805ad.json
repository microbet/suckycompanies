{"ast":null,"code":"import _classCallCheck from \"C:\\\\Users\\\\jayne\\\\dafuckisthis\\\\frontend\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\jayne\\\\dafuckisthis\\\\frontend\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"C:\\\\Users\\\\jayne\\\\dafuckisthis\\\\frontend\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"C:\\\\Users\\\\jayne\\\\dafuckisthis\\\\frontend\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"C:\\\\Users\\\\jayne\\\\dafuckisthis\\\\frontend\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"C:\\\\Users\\\\jayne\\\\dafuckisthis\\\\frontend\\\\src\\\\components\\\\Answers.js\";\nimport React, { Component } from 'react';\nimport './MainPic.css'; // import User from '../User';\n\nvar Answers =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Answers, _Component);\n\n  function Answers(props) {\n    var _this;\n\n    _classCallCheck(this, Answers);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Answers).call(this, props)); //  var user = new User();\n\n    _this.handleUlClick = function (event) {\n      console.log(\"hey \", event);\n\n      if (_this.props.user.userId) {\n        console.log(\"hey user\", _this.props.user.userId);\n        var fd = new FormData();\n        fd.append('answer_id', event.target.getAttribute('thisanswerid'));\n        console.log(\"hey answerid \", event.target.getAttribute('thisanswerid'));\n        fd.append('vote', event.target.getAttribute('vote'));\n        console.log(\"hey vote \", event.target.getAttribute('vote'));\n        fd.append('user_id', _this.props.user.userId);\n        fd.append('sessionvalue', _this.props.user.sessionvalue);\n        fetch(_this.props.DATA_URI + '/vote', {\n          method: 'POST',\n          headers: {\n            'Accept': 'application/json'\n          },\n          credentials: 'same-origin',\n          body: fd\n        }).then(function (response) {\n          return response.json();\n        }).then(function (data) {\n          _this.buildBatch(data['answer_id'], data['up'], data['down']);\n        }).catch(function (error) {\n          console.log(\"error: \", error);\n        });\n      }\n    };\n\n    _this.buildBatch = function (answerId, up, down) {\n      var i = 0;\n      var tempArr = _this.state.answerBatch;\n\n      _this.state.answerBatch.forEach(function (element) {\n        if (element[1] === parseInt(answerId)) {\n          tempArr[i][2] = up;\n          tempArr[i][3] = down;\n        }\n\n        i++;\n      });\n\n      _this.setState({\n        answerBatch: tempArr\n      });\n    };\n\n    _this.handleScroll = function (event) {\n      if (document.getElementById('answerBox').scrollHeight - document.getElementById('answerBox').offsetHeight === document.getElementById('answerBox').scrollTop) {\n        _this.fetchAnswer(_this.state.oldestAnswerId, _this.props.image.imageId, 'next', 'netUp');\n      } else if (document.getElementById('answerBox').scrollTop === 0) {\n        _this.fetchAnswer(_this.state.newestAnswerId, _this.props.image.imageId, 'previous', 'netUp');\n      } else {\n        clearInterval(_this.timer);\n\n        _this.setState({\n          scrollTimer: true\n        });\n      }\n    };\n\n    _this.state = {\n      answerBatch: [],\n      // [ [answer, answerId, up, down], ... ]\n      oldestAnswerId: 0,\n      newestAnswerId: 0,\n      firstAnswerId: 0,\n      lastAnswerId: 0,\n      mostVotedAnswerBatch: 0,\n      most: 'netUp',\n      scrollTimer: true //  userId : this.props.user.userId,\n\n    };\n    return _this;\n  }\n\n  _createClass(Answers, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      //    document.getElementById('answerBox').addEventListener('scroll', this.handleScroll);\n      // if (this.props.image.imageId) {\n      // did this happen and with what image id when you first hit most answered\n      //  console.log(\"what imageid = \", this.props.image.imageId);\n      this.fetchData();\n      this.fetchMost(this.state.most); // }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      clearInterval(this.timer); //   ReactDOM.findDOMNode(this).addEventListener('scroll', this.handleScroll);\n    }\n  }, {\n    key: \"componentWillReceiveProps\",\n    value: function componentWillReceiveProps(answerToggle) {\n      if (this.props.image.imageId) {\n        this.fetchData();\n        this.fetchMost(this.state.most); // this should probably be set in state\n      }\n    }\n  }, {\n    key: \"fetchMost\",\n    value: function fetchMost(type) {\n      var _this2 = this;\n\n      var endpoint;\n\n      if (type === 'netUp') {\n        endpoint = '/get_most_net_upvoted';\n      }\n\n      if (type === 'netDown') {\n        endpoint = '/get_most_net_downvoted';\n      }\n\n      if (type === 'mostUp') {\n        endpoint = '/get_most_upvoted';\n      }\n\n      if (type === 'mostDown') {\n        endpoint = '/get_most_downvoted';\n      }\n\n      if (type === 'most') {\n        endpoint = '/get_most_voted';\n      }\n\n      var retArr = [];\n      fetch(this.props.DATA_URI + endpoint + \"?imageId=\" + this.props.image.imageId, {\n        method: 'GET',\n        headers: {\n          'Accept': 'application/json'\n        },\n        credentials: 'same-origin'\n      }).then(function (response) {\n        return response.json();\n      }).then(function (data) {\n        var firstAnswerId = 0;\n        var lastAnswerId = 0;\n        data.forEach(function (element) {\n          retArr.push([element['answer'], element['answerId'], element['up'], element['down']]);\n\n          if (firstAnswerId === 0) {\n            firstAnswerId = element['answerId'];\n          }\n\n          lastAnswerId = element['answerId'];\n        }); //  this.setState( { mostVotedAnswerBatch : retArr } )\n\n        _this2.setState({\n          answerBatch: retArr\n        });\n\n        _this2.setState({\n          firstAnswerId: firstAnswerId\n        });\n\n        _this2.setState({\n          lastAnswerId: lastAnswerId\n        });\n      }).catch(function (error) {\n        console.log(\"error: \", error);\n      });\n    }\n  }, {\n    key: \"fetchData\",\n    value: function fetchData() {\n      var _this3 = this;\n\n      this.clearNextPrevBackground();\n      var retArr = [];\n      fetch(this.props.DATA_URI + \"/get_answers?imageId=\" + this.props.image.imageId + \"&answerId=\" + 0, {\n        method: 'GET',\n        headers: {\n          'Accept': 'application/json'\n        },\n        credentials: \"same-origin\"\n      }).then(function (response) {\n        return response.json();\n      }).then(function (data) {\n        var thisOldAnswerId = 0;\n        var thisNewAnswerId = 0;\n        data.forEach(function (element) {\n          retArr.push([element['answer'], element['answerId'], element['up'], element['down']]);\n\n          if (thisOldAnswerId === 0) {\n            thisOldAnswerId = element['answerId'];\n            thisNewAnswerId = element['answerId'];\n          } else {\n            if (element['answerId'] < thisOldAnswerId) {\n              thisOldAnswerId = element['answerId'];\n            }\n\n            if (element['answerId'] > thisNewAnswerId) {\n              thisNewAnswerId = element['answerId'];\n            }\n          }\n        });\n        retArr = retArr.sort(function (a, b) {\n          return b[1] - a[1];\n        }); // this.setState( { answerBatch : retArr } )  // turning this off for a sec to make the main display\n        // show the most upvoted like it probably should be default\n        // ok, that worked.  be sure and either get rid of or change the fetchdata which is not doing\n        // anything now\n        // also have to get the next and previous working - they're not\n\n        _this3.setState({\n          oldestAnswerId: thisOldAnswerId\n        });\n\n        _this3.setState({\n          newestAnswerId: thisNewAnswerId\n        });\n      }).catch(function (error) {\n        console.log(\"error: \", error);\n      });\n    } // just for diagnostics \n\n  }, {\n    key: \"sleep\",\n    value: function sleep(milliseconds) {\n      var start = new Date().getTime();\n\n      for (var i = 0; i < 1e7; i++) {\n        document.getElementById('answerBox').scrollTop = 506;\n\n        if (new Date().getTime() - start > milliseconds) {\n          break;\n        }\n      }\n    }\n  }, {\n    key: \"clearNextPrevBackground\",\n    value: function clearNextPrevBackground() {\n      document.getElementById('previousMainImage').setAttribute(\"style\", \"background-color: null;\");\n      document.getElementById('nextMainImage').setAttribute(\"style\", \"background-color: null;\");\n      document.getElementById('previousMainImage').removeAttribute(\"disabled\", \"true;\");\n      document.getElementById('nextMainImage').removeAttribute(\"disabled\", \"true;\");\n    } // dunno if this should be a separate function from fetchData or not, maybe combine later\n\n  }, {\n    key: \"fetchAnswer\",\n    value: function fetchAnswer(answerId, imageId, direction, type) {\n      var _this4 = this;\n\n      // (direction is 'next' or 'previous'\n      fetch(this.props.DATA_URI + \"/get_answer?imageId=\" + imageId + \"&answerId=\" + answerId + \"&direction=\" + direction + \"&type=\" + type, {\n        method: 'GET',\n        headers: {\n          'Accept': 'application/json'\n        },\n        credentials: \"same-origin\"\n      }).then(function (response) {\n        return response.json();\n      }).then(function (data) {\n        if (data.response === 'done') {\n          // do something to the next or previous button here\n          if (direction === 'next') {\n            document.getElementById('nextMainImage').setAttribute(\"style\", \"background-color: #636363;\");\n            document.getElementById('nextMainImage').setAttribute(\"disabled\", \"true;\");\n          }\n\n          if (direction === 'previous') {\n            document.getElementById('previousMainImage').setAttribute(\"style\", \"background-color: #636363;\");\n            document.getElementById('previousMainImage').setAttribute(\"disabled\", \"true;\");\n          }\n\n          return null;\n        } else {\n          _this4.clearNextPrevBackground();\n        }\n\n        var tempArr = _this4.state.answerBatch;\n\n        if (direction === 'next') {\n          tempArr.push([data[0]['answer'], data[0]['answerId'], data[0]['up'], data[0]['down']]);\n          tempArr.shift(); //  setTimeout(function() {\n          //    document.getElementById('answerBox').scrollTop = 506;\n          //  }, 500);\n        }\n\n        if (direction === 'previous') {\n          tempArr.splice(0, 0, [data[0]['answer'], data[0]['answerId'], data[0]['up'], data[0]['down']]);\n          tempArr.pop();\n        }\n\n        _this4.setState({\n          answerBatch: tempArr\n        });\n\n        if (direction === 'next') {\n          _this4.setState({\n            oldestAnswerId: data[0]['answerId']\n          });\n\n          _this4.setState({\n            lastAnswerId: data[0]['answerId']\n          });\n\n          _this4.setState({\n            newestAnswerId: tempArr[0][1]\n          });\n        }\n\n        if (direction === 'previous') {\n          _this4.setState({\n            newestAnswerId: data[0]['answerId']\n          });\n\n          _this4.setState({\n            oldestAnswerId: tempArr[9][1]\n          });\n        } //    if (this.state.scrollTimer) {\n        //      this.timer = setInterval(() => {\n        //        this.handleScroll();\n        //      }, 1000);\n        //      this.setState( { scrollTimer : false } );\n        //    }\n\n      }).catch(function (error) {\n        console.log(\"error: \", error);\n      });\n    }\n    /*\r\n    fetchPreviousAnswer(answerId, imageId) {\r\n      fetch( this.props.DATA_URI + \"/get_previous_answer?imageId=\" + imageId + \"&answerId=\" + answerId, { \r\n        credentials : \"same-origin\",\r\n        method: 'GET',\r\n        headers: {\r\n          'Accept': 'application/json',\r\n        }, \r\n      } )\r\n        .then(response => response.json())\r\n        .then(data => {\r\n          if (data.response !== 'newest') {\r\n            let tempArr = this.state.answerBatch;\r\n            tempArr.splice(0,0,[data[0]['answer'], data[0]['answerId'], \r\n              data[0]['up'], data[0]['down']]);\r\n            tempArr.pop();\r\n            this.setState( { answerBatch : tempArr } );\r\n            this.setState( { newestAnswerId : data[0]['answerId'] } );\r\n            this.setState( { oldestAnswerId : tempArr[9][1] } );\r\n              if (this.state.scrollTimer) {\r\n              this.timer = setInterval(() => {\r\n                this.handleScroll();\r\n              }, 1000);\r\n              this.setState( { scrollTimer : false } );\r\n            }\r\n          }\r\n        })\r\n        .catch(error => {\r\n          console.log(\"error: \", error);\r\n        })\r\n    }\r\n    */\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this5 = this;\n\n      //var thumbsupsrc = <img src={ this.props.DATA_URI + \"/static/images/thumbsup.png\" } alt=\"thumbup\" />;\n      //var thumbsdownsrc = <img src={ this.props.DATA_URI + \"/static/images/thumbsdown.png\" } alt=\"thumbdown\" />;\n      var display = [];\n\n      if (Array.isArray(this.state.answerBatch)) {\n        /*\r\n        if (this.state.answerBatch.length > 0) {\r\n          this.state.answerBatch.forEach((element) => {\r\n             display.push(\r\n               <ul key={element[1]} className=\"Answer-list\"><span className=\"The-Answer\">\"{element[0]}\"</span>\r\n               <span className=\"Up-Answer\" onClick={this.handleUlClick} thisanswerid={element[1]} vote=\"up\"\r\n        key={element[1] + 'upvote'}>{ this.props.user.userId ? thumbsupsrc : null }</span>\r\n        <span className=\"Up-Answer2\"> { element[2] } up</span>\r\n        <span className=\"Down-Answer\" onClick={this.handleUlClick} thisanswerid={element[1]} vote='down'\r\n        key={element[1] + 'downvote'}>{ this.props.user.userId ? thumbsdownsrc  : null }</span>\r\n        <span className=\"Down-Answer2\"> { element[3] } down</span>\t\r\n               </ul>);\r\n          });\r\n        }\r\n        */\n        var thumbsupsrc = this.props.DATA_URI + \"/static/images/thumbsup.png\";\n        var thumbsdownsrc = this.props.DATA_URI + \"/static/images/thumbsdown.png\";\n        console.log(\"answerbatch is \", this.state.answerBatch);\n\n        if (this.state.answerBatch.length > 0) {\n          this.state.answerBatch.forEach(function (element) {\n            display.push(React.createElement(\"ul\", {\n              key: element[1],\n              className: \"Answer-list\",\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 329\n              },\n              __self: this\n            }, React.createElement(\"span\", {\n              className: \"The-Answer\",\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 329\n              },\n              __self: this\n            }, \"\\\"\", element[0], \"\\\"\"), React.createElement(\"span\", {\n              className: \"Up-Answer\",\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 330\n              },\n              __self: this\n            }, element[2], \" votes up \", _this5.props.user.userId ? React.createElement(\"img\", {\n              src: thumbsupsrc,\n              alt: \"thumbup\",\n              onClick: _this5.handleUlClick,\n              thisanswerid: element[1],\n              vote: \"up\",\n              key: element[1] + 'upvote',\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 330\n              },\n              __self: this\n            }) : null), React.createElement(\"span\", {\n              className: \"Down-Answer\",\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 331\n              },\n              __self: this\n            }, element[3], \" votes down \", _this5.props.user.userId ? React.createElement(\"img\", {\n              src: thumbsdownsrc,\n              alt: \"thumbdown\",\n              onClick: _this5.handleUlClick,\n              thisanswerid: element[1],\n              vote: \"down\",\n              key: element[1] + 'downvote',\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 331\n              },\n              __self: this\n            }) : null)));\n          });\n        } // to here\n\n      }\n\n      var mostVotedDisplay = [];\n\n      if (Array.isArray(this.state.mostVotedAnswerBatch)) {\n        if (this.state.mostVotedAnswerBatch.length > 0) {\n          this.state.mostVotedAnswerBatch.forEach(function (element) {\n            mostVotedDisplay.push(React.createElement(\"ul\", {\n              key: element[1] + 'mostvoted',\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 342\n              },\n              __self: this\n            }, element[0], React.createElement(\"div\", {\n              thisanswerid: element[1],\n              vote: \"up\",\n              key: element[1] + 'mostVote',\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 343\n              },\n              __self: this\n            }, _this5.props.user.userId ? \"thumbup \" : null), React.createElement(\"div\", {\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 345\n              },\n              __self: this\n            }, \" \", element[2], \" up\"), React.createElement(\"div\", {\n              thisanswerid: element[1],\n              vote: \"down\",\n              key: element[1] + 'downvote',\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 346\n              },\n              __self: this\n            }, _this5.props.user.userId ? \"thumbdown \" : null), React.createElement(\"div\", {\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 348\n              },\n              __self: this\n            }, \" \", element[3], \" down\")));\n          });\n        }\n      }\n\n      return React.createElement(\"div\", {\n        className: \"Answer-box\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 355\n        },\n        __self: this\n      }, React.createElement(\"center\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 355\n        },\n        __self: this\n      }, React.createElement(\"button\", {\n        onClick: function onClick() {\n          _this5.fetchAnswer(_this5.state.lastAnswerId, _this5.props.image.imageId, 'next', 'netUp');\n        },\n        id: \"nextMainImage\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 356\n        },\n        __self: this\n      }, \"Next\"), React.createElement(\"button\", {\n        onClick: function onClick() {\n          _this5.fetchAnswer(_this5.state.newestAnswerId, _this5.props.image.imageId, 'previous', 'netUp');\n        },\n        id: \"previousMainImage\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 357\n        },\n        __self: this\n      }, \"Previous\")), React.createElement(\"div\", {\n        className: \"Answer-box1\",\n        id: \"answerBox\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 359\n        },\n        __self: this\n      }, display), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 362\n        },\n        __self: this\n      }), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 363\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"answerBox\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 364\n        },\n        __self: this\n      }, React.createElement(\"button\", {\n        onClick: function onClick() {\n          _this5.fetchMost('netUp');\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 365\n        },\n        __self: this\n      }, \"Net Up\"), React.createElement(\"button\", {\n        onClick: function onClick() {\n          _this5.fetchMost('netDown');\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 366\n        },\n        __self: this\n      }, \"Net Down\"), React.createElement(\"button\", {\n        onClick: function onClick() {\n          _this5.fetchMost('mostUp');\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 367\n        },\n        __self: this\n      }, \"Most Up\"), React.createElement(\"button\", {\n        onClick: function onClick() {\n          _this5.fetchMost('mostDown');\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 368\n        },\n        __self: this\n      }, \"Most Down\"), React.createElement(\"button\", {\n        onClick: function onClick() {\n          _this5.fetchMost('most');\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 369\n        },\n        __self: this\n      }, \"Most\"), mostVotedDisplay));\n    }\n  }]);\n\n  return Answers;\n}(Component);\n\nexport default Answers;","map":{"version":3,"sources":["C:\\Users\\jayne\\dafuckisthis\\frontend\\src\\components\\Answers.js"],"names":["React","Component","Answers","props","handleUlClick","event","console","log","user","userId","fd","FormData","append","target","getAttribute","sessionvalue","fetch","DATA_URI","method","headers","credentials","body","then","response","json","data","buildBatch","catch","error","answerId","up","down","i","tempArr","state","answerBatch","forEach","element","parseInt","setState","handleScroll","document","getElementById","scrollHeight","offsetHeight","scrollTop","fetchAnswer","oldestAnswerId","image","imageId","newestAnswerId","clearInterval","timer","scrollTimer","firstAnswerId","lastAnswerId","mostVotedAnswerBatch","most","fetchData","fetchMost","answerToggle","type","endpoint","retArr","push","clearNextPrevBackground","thisOldAnswerId","thisNewAnswerId","sort","a","b","milliseconds","start","Date","getTime","setAttribute","removeAttribute","direction","shift","splice","pop","display","Array","isArray","thumbsupsrc","thumbsdownsrc","length","mostVotedDisplay"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport './MainPic.css';\r\n// import User from '../User';\r\n\r\nclass Answers extends Component {\r\n  constructor(props){\r\n    super(props);\r\n  //  var user = new User();\r\n    this.state = {\r\n      answerBatch : [], // [ [answer, answerId, up, down], ... ]\r\n      oldestAnswerId : 0,\r\n      newestAnswerId : 0,\r\n      firstAnswerId : 0,\r\n      lastAnswerId : 0,\r\n      mostVotedAnswerBatch : 0,\r\n      most : 'netUp',\r\n      scrollTimer : true,\r\n    //  userId : this.props.user.userId,\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n//    document.getElementById('answerBox').addEventListener('scroll', this.handleScroll);\r\n   // if (this.props.image.imageId) {\r\n      // did this happen and with what image id when you first hit most answered\r\n    //  console.log(\"what imageid = \", this.props.image.imageId);\r\n      this.fetchData();\r\n      this.fetchMost(this.state.most);\r\n   // }\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    clearInterval(this.timer);\r\n //   ReactDOM.findDOMNode(this).addEventListener('scroll', this.handleScroll);\r\n  }\r\n  \r\n  componentWillReceiveProps(answerToggle) {\r\n    if (this.props.image.imageId) {\r\n\t  this.fetchData();\r\n\t  this.fetchMost(this.state.most); // this should probably be set in state\r\n    }\r\n  }\r\n\r\n  fetchMost(type) {\r\n    let endpoint;\r\n    if (type === 'netUp') { endpoint = '/get_most_net_upvoted'; }\r\n    if (type === 'netDown') { endpoint = '/get_most_net_downvoted'; }\r\n    if (type === 'mostUp') { endpoint = '/get_most_upvoted'; }\r\n    if (type === 'mostDown') { endpoint = '/get_most_downvoted'; }\r\n    if (type === 'most') { endpoint = '/get_most_voted'; }\r\n    let retArr = [];\r\n    fetch( this.props.DATA_URI + endpoint + \"?imageId=\" + this.props.image.imageId, {\r\n      method: 'GET',\r\n      headers: { 'Accept': 'application/json' },\r\n      credentials: 'same-origin',\r\n    })\r\n    .then(response => response.json())\r\n    .then(data => {\r\n      let firstAnswerId = 0;\r\n      let lastAnswerId = 0;\r\n      data.forEach(function(element) {\r\n        retArr.push([element['answer'], element['answerId'], \r\n        element['up'], element['down']]);\r\n        if (firstAnswerId === 0) { firstAnswerId = element['answerId']; }\r\n        lastAnswerId = element['answerId'];\r\n      });\r\n    //  this.setState( { mostVotedAnswerBatch : retArr } )\r\n      this.setState( { answerBatch : retArr } )\r\n      this.setState( { firstAnswerId : firstAnswerId } )\r\n      this.setState( { lastAnswerId : lastAnswerId } )\r\n      })\r\n      .catch(error => {\r\n        console.log(\"error: \", error);\r\n      })\r\n  }\r\n  \r\n  fetchData() {\r\n    this.clearNextPrevBackground();\r\n    let retArr = [];\r\n    fetch( this.props.DATA_URI + \"/get_answers?imageId=\" + this.props.image.imageId + \"&answerId=\" + 0, { \r\n      method: 'GET',\r\n      headers: {\r\n        'Accept': 'application/json',\r\n      }, \r\n      credentials : \"same-origin\" \r\n      } )\r\n      .then(response => response.json())\r\n      .then(data =>  {\r\n         let thisOldAnswerId = 0;\r\n         let thisNewAnswerId = 0;\r\n         data.forEach(function(element) {\r\n           retArr.push([element['answer'], element['answerId'], \r\n              element['up'], element['down']]);\r\n\t     if (thisOldAnswerId === 0) {\r\n         thisOldAnswerId = element['answerId'];\r\n         thisNewAnswerId = element['answerId'];\r\n       } else {\r\n         if (element['answerId'] < thisOldAnswerId) {\r\n           thisOldAnswerId = element['answerId'];\r\n         }\r\n         if (element['answerId'] > thisNewAnswerId) {\r\n           thisNewAnswerId = element['answerId'];\r\n         }\r\n       }\r\n     });\r\n\t retArr = retArr.sort(function(a, b) {\r\n\t   return b[1] - a[1];\r\n\t });\r\n  // this.setState( { answerBatch : retArr } )  // turning this off for a sec to make the main display\r\n        // show the most upvoted like it probably should be default\r\n        // ok, that worked.  be sure and either get rid of or change the fetchdata which is not doing\r\n        // anything now\r\n        // also have to get the next and previous working - they're not\r\n   this.setState({ oldestAnswerId : thisOldAnswerId })\r\n   this.setState({ newestAnswerId : thisNewAnswerId })\r\n   })\r\n   .catch(error => {\r\n     console.log(\"error: \", error);\r\n   })\r\n  }\r\n  \r\n// just for diagnostics \r\n sleep(milliseconds) {\r\n  var start = new Date().getTime();\r\n  for (var i = 0; i < 1e7; i++) {\r\n    document.getElementById('answerBox').scrollTop = 506;\r\n    if ((new Date().getTime() - start) > milliseconds){\r\n      break;\r\n    }\r\n  }\r\n}\r\n\r\n  clearNextPrevBackground() {\r\n    document.getElementById('previousMainImage').setAttribute(\"style\", \"background-color: null;\");\r\n    document.getElementById('nextMainImage').setAttribute(\"style\", \"background-color: null;\");\r\n    document.getElementById('previousMainImage').removeAttribute(\"disabled\", \"true;\");\r\n    document.getElementById('nextMainImage').removeAttribute(\"disabled\", \"true;\");\r\n  }\r\n\r\n  // dunno if this should be a separate function from fetchData or not, maybe combine later\r\n  fetchAnswer(answerId, imageId, direction, type) {   // (direction is 'next' or 'previous'\r\n    fetch( this.props.DATA_URI + \"/get_answer?imageId=\" + imageId + \r\n      \"&answerId=\" + answerId + \"&direction=\" + direction + \"&type=\" + type, { \r\n      method: 'GET',\r\n      headers: {\r\n        'Accept': 'application/json',\r\n      }, \r\n      credentials : \"same-origin\" } )\r\n      .then(response => response.json())\r\n      .then(data =>  {\r\n        if (data.response === 'done') {\r\n          // do something to the next or previous button here\r\n          if (direction === 'next') {\r\n            document.getElementById('nextMainImage').setAttribute(\"style\", \"background-color: #636363;\");\r\n            document.getElementById('nextMainImage').setAttribute(\"disabled\", \"true;\");\r\n          }\r\n          if (direction === 'previous') {\r\n            document.getElementById('previousMainImage').setAttribute(\"style\", \"background-color: #636363;\");\r\n            document.getElementById('previousMainImage').setAttribute(\"disabled\", \"true;\");\r\n          }\r\n          return null;\r\n        } else {\r\n          this.clearNextPrevBackground();\r\n        }\r\n        let tempArr = this.state.answerBatch;\r\n        if (direction === 'next') {\r\n\t  tempArr.push([data[0]['answer'], data[0]['answerId'],\r\n            data[0]['up'], data[0]['down']]);\r\n\t  tempArr.shift();\r\n        //  setTimeout(function() {\r\n        //    document.getElementById('answerBox').scrollTop = 506;\r\n        //  }, 500);\r\n        }\r\n        if (direction === 'previous') {\r\n          tempArr.splice(0,0,[data[0]['answer'], data[0]['answerId'], \r\n            data[0]['up'], data[0]['down']]);\r\n          tempArr.pop();\r\n        }\r\n\tthis.setState( { answerBatch : tempArr } );\r\n        if (direction === 'next') {\r\n\t  this.setState( { oldestAnswerId : data[0]['answerId'] } );\r\n\t  this.setState( { lastAnswerId : data[0]['answerId'] } );\r\n          this.setState( { newestAnswerId : tempArr[0][1] } );\r\n        }\r\n        if (direction === 'previous') {\r\n          this.setState( { newestAnswerId : data[0]['answerId'] } );\r\n          this.setState( { oldestAnswerId : tempArr[9][1] } );\r\n        }\r\n    //    if (this.state.scrollTimer) {\r\n    //      this.timer = setInterval(() => {\r\n    //        this.handleScroll();\r\n    //      }, 1000);\r\n    //      this.setState( { scrollTimer : false } );\r\n    //    }\r\n      })\r\n      .catch(error => {\r\n        console.log(\"error: \", error);\r\n      })\r\n  }\r\n\r\n  /*\r\n  fetchPreviousAnswer(answerId, imageId) {\r\n    fetch( this.props.DATA_URI + \"/get_previous_answer?imageId=\" + imageId + \"&answerId=\" + answerId, { \r\n      credentials : \"same-origin\",\r\n      method: 'GET',\r\n      headers: {\r\n        'Accept': 'application/json',\r\n      }, \r\n    } )\r\n      .then(response => response.json())\r\n      .then(data => {\r\n        if (data.response !== 'newest') {\r\n          let tempArr = this.state.answerBatch;\r\n          tempArr.splice(0,0,[data[0]['answer'], data[0]['answerId'], \r\n            data[0]['up'], data[0]['down']]);\r\n          tempArr.pop();\r\n          this.setState( { answerBatch : tempArr } );\r\n          this.setState( { newestAnswerId : data[0]['answerId'] } );\r\n          this.setState( { oldestAnswerId : tempArr[9][1] } );\r\n\r\n          if (this.state.scrollTimer) {\r\n            this.timer = setInterval(() => {\r\n              this.handleScroll();\r\n            }, 1000);\r\n            this.setState( { scrollTimer : false } );\r\n          }\r\n        }\r\n      })\r\n      .catch(error => {\r\n        console.log(\"error: \", error);\r\n      })\r\n  }\r\n  */\r\n\r\n  handleUlClick = (event) => {\r\n    console.log(\"hey \", event);\r\n    if (this.props.user.userId) {\r\n      console.log(\"hey user\", this.props.user.userId);\r\n      const fd = new FormData();\r\n      fd.append('answer_id', event.target.getAttribute('thisanswerid'));\r\n      console.log(\"hey answerid \", event.target.getAttribute('thisanswerid'));\r\n      fd.append('vote', event.target.getAttribute('vote'));\r\n      console.log(\"hey vote \", event.target.getAttribute('vote'));\r\n      fd.append('user_id', this.props.user.userId);\r\n      fd.append('sessionvalue', this.props.user.sessionvalue);\r\n      fetch( this.props.DATA_URI + '/vote', {\r\n        method: 'POST',\r\n        headers: {\r\n        'Accept': 'application/json',\r\n        },\r\n        credentials : 'same-origin',\r\n        body: fd\r\n      })\r\n      .then(response => response.json())\r\n      .then(data => {\r\n        this.buildBatch(data['answer_id'], data['up'], data['down'])\r\n      })\r\n      .catch(error => {\r\n        console.log(\"error: \", error);\r\n      });\r\n    }\r\n  }\r\n  \r\n  buildBatch = (answerId, up, down) => {\r\n    let i = 0;\r\n    let tempArr = this.state.answerBatch;\r\n    this.state.answerBatch.forEach( function(element) {\r\n\t  if (element[1] === parseInt(answerId)) {\r\n\t\ttempArr[i][2] = up;\r\n        tempArr[i][3] = down;\r\n      }\r\n\t  i++;\r\n    });\r\n    this.setState({ answerBatch : tempArr });\r\n  }\r\n\r\n  /*\r\n  handleScroll = (event) => {\r\n    console.log(\"hwkhj\");\r\n     if (ReactDOM.findDOMNode(this).scrollHeight - ReactDOM.findDOMNode(this).offsetHeight - 1 < ReactDOM.findDOMNode(this).scrollTop) {\r\n       this.fetchNextAnswer(this.state.oldestAnswerId, this.props.imageId);\r\n     } else if (ReactDOM.findDOMNode(this).scrollTop === 0) {\r\n       this.fetchPreviousAnswer(this.state.newestAnswerId, this.props.imageId);\r\n     } else {\r\n       clearInterval(this.timer);\r\n       this.setState( { scrollTimer : true } );\r\n     }\r\n  }\r\n  */\r\n  //  document.getElementById('answerBox').addEventListener('scroll', this.handleScroll);\r\n\r\n  handleScroll = (event) => {\r\n     if (document.getElementById('answerBox').scrollHeight - document.getElementById('answerBox').offsetHeight === document.getElementById('answerBox').scrollTop) {\r\n       this.fetchAnswer(this.state.oldestAnswerId, this.props.image.imageId, 'next', 'netUp');\r\n     } else if (document.getElementById('answerBox').scrollTop === 0) {\r\n       this.fetchAnswer(this.state.newestAnswerId, this.props.image.imageId, 'previous', 'netUp');\r\n     } else {\r\n       clearInterval(this.timer);\r\n       this.setState( { scrollTimer : true } );\r\n     }\r\n  }\r\n\r\n  render() {\r\n    //var thumbsupsrc = <img src={ this.props.DATA_URI + \"/static/images/thumbsup.png\" } alt=\"thumbup\" />;\r\n    //var thumbsdownsrc = <img src={ this.props.DATA_URI + \"/static/images/thumbsdown.png\" } alt=\"thumbdown\" />;\r\n    let display = [];\r\n    if (Array.isArray(this.state.answerBatch)) {\r\n      /*\r\n      if (this.state.answerBatch.length > 0) {\r\n        this.state.answerBatch.forEach((element) => {\r\n           display.push(\r\n             <ul key={element[1]} className=\"Answer-list\"><span className=\"The-Answer\">\"{element[0]}\"</span>\r\n             <span className=\"Up-Answer\" onClick={this.handleUlClick} thisanswerid={element[1]} vote=\"up\"\r\n\t\t\t\tkey={element[1] + 'upvote'}>{ this.props.user.userId ? thumbsupsrc : null }</span>\r\n\t\t\t\t<span className=\"Up-Answer2\"> { element[2] } up</span>\r\n\t\t\t<span className=\"Down-Answer\" onClick={this.handleUlClick} thisanswerid={element[1]} vote='down'\r\n\t\t\t\tkey={element[1] + 'downvote'}>{ this.props.user.userId ? thumbsdownsrc  : null }</span>\r\n\t\t\t\t<span className=\"Down-Answer2\"> { element[3] } down</span>\t\r\n             </ul>);\r\n        });\r\n      }\r\n      */\r\n    var thumbsupsrc = this.props.DATA_URI + \"/static/images/thumbsup.png\";\r\n    var thumbsdownsrc = this.props.DATA_URI + \"/static/images/thumbsdown.png\";\r\n      console.log(\"answerbatch is \", this.state.answerBatch);\r\n      if (this.state.answerBatch.length > 0) {\r\n        this.state.answerBatch.forEach((element) => {\r\n           display.push(\r\n             <ul key={element[1]} className=\"Answer-list\"><span className=\"The-Answer\">\"{element[0]}\"</span>\r\n             <span className=\"Up-Answer\">{element[2]} votes up { this.props.user.userId ? <img src={ thumbsupsrc } alt=\"thumbup\" onClick={this.handleUlClick} thisanswerid={element[1]} vote=\"up\" key={element[1] + 'upvote'} /> : null }</span>\r\n             <span className=\"Down-Answer\">{element[3]} votes down { this.props.user.userId ? <img src={ thumbsdownsrc } alt=\"thumbdown\" onClick={this.handleUlClick} thisanswerid={element[1]} vote=\"down\" key={element[1] + 'downvote'} /> : null }</span>\r\n             </ul>);\r\n        });\r\n      }\r\n      // to here\r\n    }\r\n    let mostVotedDisplay = []\r\n\tif (Array.isArray(this.state.mostVotedAnswerBatch)) {\r\n\t\tif (this.state.mostVotedAnswerBatch.length > 0) {\r\n\t\t\tthis.state.mostVotedAnswerBatch.forEach((element) => {\r\n\t\t\t\tmostVotedDisplay.push(\r\n\t\t\t\t\t<ul key={element[1] + 'mostvoted'}>{element[0]}\r\n\t\t\t<div thisanswerid={element[1]} vote='up'\r\n\t\t\t\tkey={element[1] + 'mostVote'}>{ this.props.user.userId ? \"thumbup \" : null }</div>\r\n\t\t\t\t<div> { element[2] } up</div>\r\n\t\t\t<div thisanswerid={element[1]} vote='down'\r\n\t\t\t\tkey={element[1] + 'downvote'}>{ this.props.user.userId ? \"thumbdown \" : null }</div>\r\n\t\t\t\t<div> { element[3] } down</div>\r\n\t\t\t\t</ul>);\r\n\t\t});\r\n\t  }\r\n\t}\r\n\t\r\n    return(\r\n\t<div className=\"Answer-box\"><center>\r\n      <button onClick={() => {this.fetchAnswer(this.state.lastAnswerId, this.props.image.imageId, 'next', 'netUp')}} id=\"nextMainImage\">Next</button>\r\n      <button onClick={() => {this.fetchAnswer(this.state.newestAnswerId, this.props.image.imageId, 'previous', 'netUp')}} id=\"previousMainImage\">Previous</button>\r\n      </center>\r\n          <div className=\"Answer-box1\" id=\"answerBox\">\r\n          { display }\r\n\t\t  </div>\r\n\t\t\t<br />\r\n\t\t\t<br />\r\n\t\t\t<div className=\"answerBox\">\r\n     <button onClick={() => {this.fetchMost('netUp')}}>Net Up</button>\r\n     <button onClick={() => {this.fetchMost('netDown')}}>Net Down</button>\r\n     <button onClick={() => {this.fetchMost('mostUp')}}>Most Up</button>\r\n     <button onClick={() => {this.fetchMost('mostDown')}}>Most Down</button>\r\n     <button onClick={() => {this.fetchMost('most')}}>Most</button>\r\n\t\t\t{ mostVotedDisplay }\r\n          </div>\r\n\t\t  </div>\r\n\t);\r\n    }\r\n}\r\n\r\nexport default Answers \r\n"]},"metadata":{},"sourceType":"module"}